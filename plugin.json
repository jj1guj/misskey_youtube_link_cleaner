{
  "type": "plugin",
  "data": "/// @ 0.12.4\n### {\n    name: \"YouTube Link Cleaner\"\n    version: \"0.1.0\"\n    author: \"@jj1guj\"\n    description: \"投稿時に YouTube URL の追跡クエリ (?si など) を削除します\"\n}\n\n@is_youtube(u) {\n    (u.index_of(\"youtu.be\") != -1) || (u.index_of(\"youtube.com\") != -1)  // true/false\n}\n\n@cleanUrl(u) {\n    if (is_youtube(u)) {\n        // クエリ文字列が存在する\n        if (u.split(\"?\").len > 1) {\n            var query_list = u.split(\"?\")[1].split(\"&\")\n            for (let i, query_list.len) {\n                // 追跡クエリを削除\n                if (query_list[i].index_of(\"si=\") != -1) {\n                    query_list[i] = \"\"\n                }\n            }\n            let query = query_list.join(\"\")\n            if (query != \"\") {\n                return `{u.split(\"?\")[0]}?{query}`\n            } else {\n                return u.split(\"?\")[0]\n            }\n        }\n        return u\n    } else {\n        u\n    }\n}\n\n// test\nPlugin:register_post_form_action('YouTube Link Cleaner', @(note, rewrite) {\n    if (note.text == null) {\n        return note\n    }\n\n    let parts = note.text.split(\" \")\n    var out = \"\"\n\n    for (let i, parts.len) {\n        parts[i] = cleanUrl(parts[i])\n        if (out == \"\") {\n            out = `{out}{cleanUrl(parts[i])}`\n        } else {\n            out = `{out} {cleanUrl(parts[i])}`\n        }\n    }\n    rewrite('text', out)\n})\n"
}
